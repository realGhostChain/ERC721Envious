<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for mocks/RebaseToken.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">mocks/</a> RebaseToken.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/77</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/27</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/77</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: AGPL-3.0
&nbsp;
pragma solidity ^0.8.0;
&nbsp;
import "../openzeppelin/utils/Address.sol";
import "../openzeppelin/utils/math/SafeMath.sol";
&nbsp;
import "../openzeppelin/token/ERC20/extensions/draft-ERC20Permit.sol";
&nbsp;
import "../interfaces/IgSTRL.sol";
import "../interfaces/IsSTRL.sol";
import "../interfaces/IStaking.sol";
&nbsp;
contract RebaseToken is IsSTRL, ERC20Permit {
	// PLEASE READ BEFORE CHANGING ANY ACCOUNTING OR MATH
	// Anytime there is division, there is a risk of numerical instability from rounding errors.
	// In order to minimize this risk, we adhere to the following  guidelines:
	// 1) The conversion rate adopted is the number of gons that equals 1 fragment.
	//    The inverse rate must not be used--TOTAL_GONS is always the numerator and _totalSupply is
	//    always the denominator. (i.e. If you want to convert gons to fragments instead of
	//    multiplying by the inverse rate, you should divide by the normal rate)
	// 2) Gon balances converted into Fragments are always rounded down (truncted).
	//
	// We make the following guarantees:
	// - If address 'A' transfers x Fragments to address 'B'. A's resulting external balance will
	//   be decreased by precisely x Fragments, and B's external balance will be precisely
	//   increased by x Fragments.
	//
	// We do not guarantee that the sum of all balances equals the result of calling totalSupply().
	// This is because, for any conversion function 'f()' that has non-zero rounding error,
	// f(x0) + f(x1) + ... + f(xn) is not always equal to f(x0 + x1 + ... + xn).
&nbsp;
	using SafeMath for uint256;
&nbsp;
	address public stakingContract; // balance used to calc rebase
&nbsp;
<span class="fstat-no" title="function not covered" >	modifier onlyStakingContract() {</span>
<span class="cstat-no" title="statement not covered" >		require(msg.sender == stakingContract, "sSTRL: only for staking contract")</span>;
		_;
	}
&nbsp;
	address internal initializer;
&nbsp;
	uint256 internal INDEX; // Index Gons - track rebase growth
&nbsp;
	IgSTRL public gSTRL; // additional staked supply (governance/bridge token)
&nbsp;
	Rebase[] public rebases; // past rebase data
&nbsp;
	// NOTE: {ERC20-_totalSupply} marked as private in latest version of openzeppelin
	// so we need to re-declare it here
	uint256 private _totalSupply;
&nbsp;
	uint256 private constant MAX_UINT256 = type(uint256).max;
	uint256 private constant INITIAL_FRAGMENTS_SUPPLY = 5 * 10**15; // 5*10^6 (amount) * 10^9 (decimals)
&nbsp;
	// TOTAL_GONS is a multiple of INITIAL_FRAGMENTS_SUPPLY so that _gonsPerFragment
	// is an integer. Use the highest value that fits in a uint256 for max granularity.
	uint256 private constant TOTAL_GONS = MAX_UINT256 - (MAX_UINT256 % INITIAL_FRAGMENTS_SUPPLY);
&nbsp;
	// MAX_SUPPLY = maximum integer &lt; (sqrt(4*TOTAL_GONS + 1) - 1) / 2
	uint256 private constant MAX_SUPPLY = type(uint128).max; // (2^128)-1
&nbsp;
	uint256 private _gonsPerFragment;
	mapping(address =&gt; uint256) private _gonBalances;
&nbsp;
	// This is denominated, because the gons-fragments conversion might change before
	// it's fully paid.
	mapping(address =&gt; mapping(address =&gt; uint256)) private _allowedValue;
&nbsp;
	address public treasury;
	mapping(address =&gt; uint256) public override debtBalances;
&nbsp;
<span class="fstat-no" title="function not covered" >	constructor() ERC20("Staked eGHST", "sGHST")</span>
	ERC20Permit("Staked eGHST")
	{
<span class="cstat-no" title="statement not covered" >		initializer = msg.sender</span>;
<span class="cstat-no" title="statement not covered" >		_totalSupply = INITIAL_FRAGMENTS_SUPPLY</span>;
<span class="cstat-no" title="statement not covered" >		_gonsPerFragment = TOTAL_GONS.div(_totalSupply)</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function decimals() public pure virtual override returns (uint8) {</span>
<span class="cstat-no" title="statement not covered" >		return 9;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function setIndex(uint256 _index) external {</span>
<span class="cstat-no" title="statement not covered" >		require(msg.sender == initializer, "sSTRL: only from initializer")</span>;
<span class="cstat-no" title="statement not covered" >		require(INDEX == 0, "sSTRL: index already set")</span>;
<span class="cstat-no" title="statement not covered" >		INDEX = gonsForBalance(_index)</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function setgSTRL(address _gSTRL) external {</span>
<span class="cstat-no" title="statement not covered" >		require(msg.sender == initializer, "sSTRL: only from initializer")</span>;
<span class="cstat-no" title="statement not covered" >		require(address(gSTRL) == address(0), "sSTRL: gSTRL address already set")</span>;
<span class="cstat-no" title="statement not covered" >		require(_gSTRL != address(0), "sSTRL: gSTRL is not a valid contract")</span>;
<span class="cstat-no" title="statement not covered" >		gSTRL = IgSTRL(_gSTRL)</span>;
	}
&nbsp;
	// do this last
<span class="fstat-no" title="function not covered" >	function initialize(address _stakingContract, address _treasury) external {</span>
<span class="cstat-no" title="statement not covered" >		require(msg.sender == initializer, "sSTRL: only from initializer")</span>;
<span class="cstat-no" title="statement not covered" >		require(_stakingContract != address(0), "sSTRL: Staking is not a valid contract")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		stakingContract = _stakingContract</span>;
<span class="cstat-no" title="statement not covered" >		_gonBalances[_stakingContract] = TOTAL_GONS</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		require(_treasury != address(0), "sSTRL: Treasury is not a valid contract")</span>;
<span class="cstat-no" title="statement not covered" >		treasury = _treasury</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		emit Transfer(address(0x0), _stakingContract, _totalSupply);</span>
<span class="cstat-no" title="statement not covered" >		emit LogStakingContractUpdated(_stakingContract);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		initializer = address(0)</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function scaledTotalSupply() external pure override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return TOTAL_GONS;</span>
	}
&nbsp;
	/**
	 * @dev Notifies contract about a new rebase cycle.
	 * @param profit_ The number of new tokens to add into circulation via expansion.
	 * @return The total number of sSTRL after the supply adjustment.
	 */
<span class="fstat-no" title="function not covered" >	function rebase(uint256 profit_, uint256 epoch_)</span>
		public
	   	override
	   	onlyStakingContract
	   	returns (uint256)
	{
<span class="cstat-no" title="statement not covered" >		uint256 rebaseAmount;</span>
<span class="cstat-no" title="statement not covered" >		uint256 circulatingSupply_ = circulatingSupply();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (profit_ == 0) {</span>
<span class="cstat-no" title="statement not covered" >			emit LogRebase(epoch_, _totalSupply, 0, index());</span>
<span class="cstat-no" title="statement not covered" >			return _totalSupply;</span>
		} else <span class="cstat-no" title="statement not covered" >if (circulatingSupply_ &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >			rebaseAmount = profit_.mul(_totalSupply).div(circulatingSupply_)</span>;
		} else {
<span class="cstat-no" title="statement not covered" >			rebaseAmount = profit_</span>;
		}
&nbsp;
<span class="cstat-no" title="statement not covered" >		_totalSupply = _totalSupply.add(rebaseAmount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (_totalSupply &gt; MAX_SUPPLY) {</span>
<span class="cstat-no" title="statement not covered" >			_totalSupply = MAX_SUPPLY</span>;
		}
&nbsp;
<span class="cstat-no" title="statement not covered" >		_gonsPerFragment = TOTAL_GONS.div(_totalSupply)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		_storeRebase(circulatingSupply_, profit_, epoch_)</span>;
&nbsp;
		// From this point forward, _gonsPerFragment is taken as the source of truth.
		// We recalculate a new _totalSupply to be in agreement with the _gonsPerFragment
		// conversion rate.
		//
		// This means our applied profit can deviate from the requested profit,
		// but this deviation is guaranteed to be &lt; (_totalSupply^2)/(TOTAL_GONS - _totalSupply).
		//
		// In the case of _totalSupply &lt;= MAX_UINT128 (our current supply cap), this deviation is
		// guaranteed to be &lt; 1, so we can omit this step. If the supply cap is ever increased,
		// it must be re-included.
		// _totalSupply = TOTAL_GONS.div(_gonsPerFragment)
&nbsp;
<span class="cstat-no" title="statement not covered" >		return _totalSupply;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function _storeRebase(</span>
		uint256 previousCirculating_,
		uint256 profit_,
		uint256 epoch_
	) internal {
<span class="cstat-no" title="statement not covered" >		uint256 rebasePercent = profit_.mul(1e18).div(previousCirculating_);</span>
<span class="cstat-no" title="statement not covered" >		rebases.push(</span>
			Rebase({
				epoch: epoch_,
				rebase: rebasePercent, // 18 decimals
				totalStakedBefore: previousCirculating_,
				totalStakedAfter: circulatingSupply(),
				amountRebased: profit_,
				index: index(),
				blockNumberOccured: block.number
			})
		);
&nbsp;
<span class="cstat-no" title="statement not covered" >		emit LogRebase(epoch_, _totalSupply, rebasePercent, index());</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function transfer(</span>
		address to,
		uint256 value
	) public override(IERC20, ERC20) returns (bool) {
<span class="cstat-no" title="statement not covered" >		uint256 gonValue = gonsForBalance(value);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		_gonBalances[msg.sender] = _gonBalances[msg.sender].sub(gonValue)</span>;
<span class="cstat-no" title="statement not covered" >		_gonBalances[to] = _gonBalances[to].add(gonValue)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		_checkDebt(msg.sender)</span>;
<span class="cstat-no" title="statement not covered" >		emit Transfer(msg.sender, to, value);</span>
<span class="cstat-no" title="statement not covered" >		return true;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function transferFrom(</span>
		address from,
		address to,
		uint256 value
	) public override(IERC20, ERC20) returns (bool) {
<span class="cstat-no" title="statement not covered" >		_allowedValue[from][msg.sender] = _allowedValue[from][msg.sender].sub(value)</span>;
<span class="cstat-no" title="statement not covered" >		emit Approval(from, msg.sender, _allowedValue[from][msg.sender]);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		uint256 gonValue = gonsForBalance(value);</span>
<span class="cstat-no" title="statement not covered" >		_gonBalances[from] = _gonBalances[from].sub(gonValue)</span>;
<span class="cstat-no" title="statement not covered" >		_gonBalances[to] = _gonBalances[to].add(gonValue)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		_checkDebt(from)</span>;
<span class="cstat-no" title="statement not covered" >		emit Transfer(msg.sender, to, value);</span>
<span class="cstat-no" title="statement not covered" >		return true;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function approve(address spender, uint256 value) public override(IERC20, ERC20) returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >		_approve(msg.sender, spender, value)</span>;
<span class="cstat-no" title="statement not covered" >		return true;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function increaseAllowance(address spender, uint256 value) public override returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >		_approve(msg.sender, spender, _allowedValue[msg.sender][spender].add(value))</span>;
<span class="cstat-no" title="statement not covered" >		return true;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function decreaseAllowance(address spender, uint256 value) public override returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >		uint256 oldValue = _allowedValue[msg.sender][spender];</span>
<span class="cstat-no" title="statement not covered" >		uint256 amount = (value &gt;= oldValue) ? 0 : oldValue.sub(value);</span>
<span class="cstat-no" title="statement not covered" >		_approve(msg.sender, spender, amount)</span>;
<span class="cstat-no" title="statement not covered" >		return true;</span>
	}
&nbsp;
	// this function is called by the treasury, and informs sSTRL of changes to debt.
	// note that addresses with debt balances cannot transfer collateralized sSTRL
	// until the debt has been repaid.
<span class="fstat-no" title="function not covered" >	function changeDebt(</span>
		uint256 amount,
		address debtor,
		bool add
	) external override {
<span class="cstat-no" title="statement not covered" >		require(msg.sender == treasury, "sSTRL: only Treasury")</span>;
<span class="cstat-no" title="statement not covered" >		debtBalances[debtor] = add ? debtBalances[debtor].add(amount) : debtBalances[debtor].sub(amount)</span>;
<span class="cstat-no" title="statement not covered" >		_checkDebt(debtor)</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function _checkDebt(address from) internal view {</span>
<span class="cstat-no" title="statement not covered" >		require(balanceOf(from) &gt;= debtBalances[from], "sSTRL: cannot transfer amount")</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function _approve(</span>
		address owner,
		address spender,
		uint256 value
	) internal virtual override {
<span class="cstat-no" title="statement not covered" >		_allowedValue[owner][spender] = value</span>;
<span class="cstat-no" title="statement not covered" >		emit Approval(owner, spender, value);</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function balanceOf(address account) public view override(IERC20, ERC20) returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return _gonBalances[account].div(_gonsPerFragment);</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function scaledBalanceOf(address account) external view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return _gonBalances[account];</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function gonsForBalance(uint256 amount) public view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return amount.mul(_gonsPerFragment);</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function balanceForGons(uint256 gons) public view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return gons.div(_gonsPerFragment);</span>
	}
&nbsp;
	// toG converts an sSTRL balance to gSTRL terms. gSTRL is an 18 decimal token.
	// balance given is in 18 decimals format.
<span class="fstat-no" title="function not covered" >	function toG(uint256 amount) external view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return gSTRL.balanceTo(amount);</span>
	}
&nbsp;
	// fromG converts a gSTRL balance to sSTRL terms. sSTRL is a 9 decimals token.
	// balance given is in 9 decimals format.
<span class="fstat-no" title="function not covered" >	function fromG(uint256 amount) external view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return gSTRL.balanceFrom(amount);</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function totalSupply() public view override(ERC20, IERC20) returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return _totalSupply;</span>
	}
&nbsp;
	// staking contract holds excess sSTRL
<span class="fstat-no" title="function not covered" >	function circulatingSupply() public view override returns (uint256) {</span>
		// NOTE: changed for mocking purposes
<span class="cstat-no" title="statement not covered" >		return _totalSupply;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function index() public view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return balanceForGons(INDEX);</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function allowance(address owner, address spender) public view override(IERC20, ERC20) returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		return _allowedValue[owner][spender];</span>
	}
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Oct 10 2022 10:59:40 GMT-0400 (Eastern Daylight Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
